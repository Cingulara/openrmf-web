function setupOpenRMFUI(e){$("#main").show(),"undefined"!=typeof keycloak&&(setupTimers(),$("#includeAutoLogin").load("/includes/modalLogout.html")),$("#includeNavBarLink").load("/includes/navbar.html"),$("#includeSidebarLink").load("/includes/sidebarmenu.html"),$("#includeFooterLink").load("/includes/footertext.html"),$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)}})}function menuMetricsLink(){urlMetricsMenuLink?window.open(urlMetricsMenuLink,"openrmf-metrics"):alert("The Metrics menu has not been configured yet.")}function menuKeycloakLink(){urlKeycloakMenuLink?window.open(urlKeycloakMenuLink,"openrmf-users"):alert("The Users menu has not been configured yet.")}var warningTimerID,timeoutTimerID,keycloakTimerID,warningTimeout=84e4,timeoutNow=6e4,keycloakTimeout=295e3,bWarningAutoLogout=!1;function startLogoutTimer(){warningTimerID=window.setTimeout(warningInactive,warningTimeout)}function startKeycloakUpdateTimer(){keycloakTimerID=window.setTimeout(updateKeycloakToken,keycloakTimeout)}function warningInactive(){bWarningAutoLogout=!0,window.clearTimeout(warningTimerID),timeoutTimerID=window.setTimeout(IdleTimeout,timeoutNow),$("#modalAutoLogout").modal("show")}function resetLogoutTimer(){bWarningAutoLogout||(window.clearTimeout(timeoutTimerID),window.clearTimeout(warningTimerID),startLogoutTimer())}function updateKeycloakToken(){keycloak.updateToken(300).success((()=>{window.clearTimeout(keycloakTimerID),startKeycloakUpdateTimer()})).error((()=>{console.log("Keycloak token refresh unsuccessful")}))}function IdleTimeout(){autoLogout()}function setupTimers(){document.addEventListener("mousemove",resetLogoutTimer,!1),document.addEventListener("mousedown",resetLogoutTimer,!1),document.addEventListener("keypress",resetLogoutTimer,!1),document.addEventListener("touchmove",resetLogoutTimer,!1),document.addEventListener("onscroll",resetLogoutTimer,!1),startLogoutTimer(),startKeycloakUpdateTimer()}function logout(){var e={redirectUri:document.location.protocol+"//"+document.location.host+"/logout.html"};keycloak.logout(e).then((e=>{console.log("--\x3e log: logout success ",e)})).catch((e=>{console.log("--\x3e log: logout error ",e)}))}function autoLogout(){var e={redirectUri:document.location.protocol+"//"+document.location.host+"/logout.html?autologout=true"};keycloak.logout(e).then((e=>{console.log("--\x3e log: logout success ",e)})).catch((e=>{console.log("--\x3e log: logout error ",e)}))}function openProfile(){location.href=keycloak.createAccountUrl()}async function getSystemTotalCount(){let e=await fetch(readAPI+"count/systems",{headers:{Authorization:"Bearer "+keycloak.token}});if(e.ok){var t=await e.json();$("#numberSystemsTotal").html(t),$("#numberNewSystemsTotal").text(t)}else $("#numberSystemsTotal").html("error"),$("#numberNewSystemsTotal").text("error"),401==e.status?swal("There is an Authentication problem. Please logout and log back in. And have the application administrator verify your API's authentication settings.","Click OK to continue!","error"):401==e.status&&swal("There is an application problem. Please have the application administrator verify your system is 100% healthy and running correctly.","Click OK to continue!","error")}async function getChecklistTotalCount(){let e=await fetch(readAPI+"count/artifacts",{headers:{Authorization:"Bearer "+keycloak.token}});if(e.ok){var t=await e.json();$("#numberChecklistsTotal").html(t),$("#numberNewChecklistsTotal").text(t)}else $("#numberChecklistsTotal").html("error"),$("#numberNewChecklistsTotal").text("error"),401==e.status?swal("There is an Authentication problem. Please logout and log back in. And have the application administrator verify your API's authentication settings.","Click OK to continue!","error"):401==e.status&&swal("There is an application problem. Please have the application administrator verify your system is 100% healthy and running correctly.","Click OK to continue!","error")}async function getTemplateTotalCount(){let e=await fetch(templateAPI+"count/templates",{headers:{Authorization:"Bearer "+keycloak.token}});if(e.ok){var t=await e.json();$("#numberTemplatesTotal").html(t),$("#numberNewTemplatesTotal").text(t)}else $("#numberTemplatesTotal").html("error"),$("#numberNewTemplatesTotal").text("error"),401==e.status?swal("There is an Authentication problem. Please logout and log back in. And have the application administrator verify your API's authentication settings.","Click OK to continue!","error"):401==e.status&&swal("There is an application problem. Please have the application administrator verify your system is 100% healthy and running correctly.","Click OK to continue!","error")}async function getSystemsForDashboard(){sessionStorage.removeItem("checklistSystems"),$("#checklistSystem").children().remove().end(),$("#checklistSystem").append('<option value="">[Choose a System Package]</option>'),$("#checklistACASSystem").children().remove().end(),$("#checklistACASSystem").append('<option value="">[Choose a System Package]</option>');var e=await getChecklistSystems();e&&$.each(e,(function(e,t){optionString='<option value="'+t.internalIdString+'">'+t.title+"</option>",$("#checklistSystem").append(optionString),$("#checklistACASSystem").append(optionString)}))}async function getSystemOpenItemsForDashboard(){var e=$("#checklistSystem").val();if(e){$("#divSystemCategoryDashboard").show();var t=await getScoreForSystemChecklistListing(e);t&&($("#numberCAT1Open").html(t.totalCat1Open),$("#numberCAT1OpenItems").text(t.totalCat1Open),$("#numberCAT2Open").html(t.totalCat2Open),$("#numberCAT2OpenItems").text(t.totalCat2Open),$("#numberCAT3Open").html(t.totalCat3Open),$("#numberCAT3OpenItems").text(t.totalCat3Open))}else $("#divSystemCategoryDashboard").hide()}function loadSystemFromDashboardCategory(e){var t=$("#checklistSystem").val();t&&(location.href="checklists.html?id="+t+"&category="+e)}async function getSystemACASItemsForDashboard(){var e=$("#checklistACASSystem").val();if(e){var t=await getNessusFileSummaryData(e);t?($("#divSystemACASPatchListing").show(),$("#divNessusStatus").hide(),$("#numberCriticalOpen").html(t.totalCriticalOpen),$("#numberHighOpen").html(t.totalHighOpen),$("#numberMediumOpen").html(t.totalMediumOpen),$("#numberLowOpen").html(t.totalLowOpen)):($("#divSystemACASPatchListing").hide(),$("#divNessusStatus").html("There is no current Nessus patch file loaded for this <a href='checklists.html?id="+e+"'>system package</a>."),$("#divNessusStatus").show())}else $("#divSystemACASPatchListing").hide(),$("#divNessusStatus").html("There is no current valid Nessus patch file loaded for this system."),$("#divNessusStatus").show()}async function getTemplates(e){$.blockUI({message:"Updating the template listing...please wait",css:{padding:"15px"}}),$("#tblChecklistListing").DataTable().ajax.url(templateAPI).load(finalizeLoadingTable)}async function getScoreForTemplateListing(e){var t=new FormData;t.append("rawChecklist",e),$.ajax({url:scoreAPI,data:t,type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},processData:!1,contentType:!1,success:function(e){displayChecklistScores(e)}})}async function deleteTemplate(e){e&&e.length>10&&swal({title:"Delete this Template?",text:"Are you sure you wish to delete this template?",icon:"warning",buttons:!0,dangerMode:!0}).then((t=>{t?$.ajax({url:templateAPI+e,type:"DELETE",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your Template was deleted successfully!","Click OK to continue!","success").then((e=>{location.href="templates.html"}))},error:function(e){swal("There was a Problem. Your Template was not deleted successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the Deletion.")}))}async function getChecklistSystemsForChecklistCreation(){var e=await getChecklistSystems();e&&$.each(e,(function(e,t){$("#checklistSystemPackage").append($("<option/>",{value:t.internalIdString,text:t.title}))}))}async function createChecklistFromTemplate(){var e=$("#checklistSystemPackage").val(),t=$("#templateIdForChecklist").val();t&&t.length>10&&e?swal({title:"Create a Checklist from this Template?",text:"Are you sure you wish to create a new checklist using this template?",icon:"warning",buttons:!0,dangerMode:!1}).then((a=>{a?$.ajax({url:uploadAPI+e+"/template/"+t,type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your Checklist was created successfully!","Click OK to continue!","success")},error:function(e){swal("There was a Problem. Your Checklist was not created successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the Checklist Creation.")})):alert("Please select a valid system package")}function listSystems(){location.href="systems.html"}async function getSystemListing(){$.blockUI({message:"Updating the system listing...",css:{padding:"15px"}});var e=readAPI+"systems/";$("#divSystemListing").show(),$("#txtSystemName").val(""),sessionStorage.removeItem("checklistSystems");let t=await fetch(e,{headers:{Authorization:"Bearer "+keycloak.token}});if(t.ok){var a="";if(0==(o=await t.json()).length){$.unblockUI();var s="There are no System Packages in here. Please add your first System or Upload your first checklist to get started.";s+='<button type="button" class="close" data-dismiss="alert" aria-label="Close">',s+='<span aria-hidden="true">&times;</span></button>',$("#divMessaging").html(s),$("#divMessaging").show()}else{$("#btnExportListToExcel").prop("disabled",!1),$("#divMessaging").html(""),$("#divMessaging").hide();var n=0;$("#divSystemListing").html("");for(const e of o){var o;n+=1,a='<div class="systemListing"><div class="systemListTitle"><a href="checklists.html?id='+e.internalIdString+'" ',a+='title="View the system package information and checklists" >'+e.title+" ("+e.numberOfChecklists+")</a>",a+='</div><div class="systemDescription">',e.description?a+=htmlEscape(e.description):a+="<i>(No description)</i>",a+='</div><div class="systemListInfo"><canvas ',a+='class="systemChart" id="pieChart'+n+'"></canvas> ',a+='<div style="clear: both;"></div></div></div>',$("#divSystemListing").append(a),(o=await getScoreForSystemChecklistListing(e.internalIdString))&&renderSystemPieChart("pieChart"+n,o)}$.unblockUI()}}else{$.unblockUI();s="There is a problem fetching the system listing. Please check that all available services are alive and well.";s+='<button type="button" class="close" data-dismiss="alert" aria-label="Close">',s+='<span aria-hidden="true">&times;</span></button>',$("#divMessaging").html(s),$("#divMessaging").show()}}function getSystemRecordBySession(){var e=sessionStorage.getItem("currentSystem");e?getSystemRecord(e):location.href="systems.html"}function reloadSystemRecordBySession(){var e=sessionStorage.getItem("currentSystem");location.href=e&&"undefined"!=e?"checklists.html?id="+e:"systems.html"}async function getSystemRecord(e){var t=readAPI;t+="system/"+encodeURIComponent(e);let a=await fetch(t,{headers:{Authorization:"Bearer "+keycloak.token}});if(!a.ok)throw $.unblockUI(),new Error(a.status);var s=await a.json();if(0==s.length){$.unblockUI();'<button type="button" class="close" data-dismiss="alert" aria-label="Close">','<span aria-hidden="true">&times;</span></button>',$("#divMessaging").html('That is not a valid System. Please return to the Systems page and click on a valid system.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),$("#divMessaging").show()}else{if($("#modalSystemTitle").text(s.title),$("#divSystemTitle").html("<b>Title:</b> "+s.title),$("#frmSystemTitle").val(s.title),s.description?($("#divSystemDescription").html("<b>Description:</b> "+htmlEscape(s.description)),$("#frmSystemDescription").val(s.description)):$("#divSystemDescription").html("<b>Description:</b> (no description)"),$("#divNumberChecklists").html("<b>Checklists:</b> "+s.numberOfChecklists),s.rawNessusFile){var n="<b>Patch Scan:</b><br />&nbsp;&nbsp;&nbsp;";if(canDownload()){var o="latest upload";s.nessusFilename&&(o=s.nessusFilename),n+='<a title="Export the Nessus scan Summary to XLSX ('+o+')" href="javascript:exportNessusXML(\''+s.internalIdString+"', true)\">",n+="Summary Export</a> ",n+=' | <a title="Export the Nessus scan to XLSX by Host ('+o+')" href="javascript:exportNessusXML(\''+s.internalIdString+"', false)\">",n+="Host Export</a>",n+=' | <a title="Download the Nessus Scan ('+o+')" href="javascript:downloadNessusXML(\''+s.internalIdString+'\')">Download</a> | <a title="Remove the Nessus Scan file" href="javascript:deleteSystemPatchScanFile(\''+s.internalIdString+"')\">Remove</a>"}else n+=" Yes";$("#divSystemNessusFile").html(n)}else if(canUpload()){$("#divSystemNessusFile").html('<b>Nessus Scan:</b> <a href="#custom-modal"  id="btnUpdateSystem"  data-target="#customModal" data-toggle="modal"><span>(click to upload)</span></a>')}else $("#divSystemNessusFile").html("<b>Patch Scan:</b> N/A");if(canDownload()){' title="Generate the Test Plan Summary in MS Excel" ','class="btn btn-success btn-sm"><span class="btn-label"><i class="fa fa-clipboard"></i></span> Generate Test Plan</button>',$("#divSystemTestPlan").html('<button style="margin: 2px; width: 100%; text-align: left;" type="button" id="btnGenerateTestPlanSummary" onclick="exportTestPlan(getParameterByName(\'id\'), false);"  title="Generate the Test Plan Summary in MS Excel" class="btn btn-success btn-sm"><span class="btn-label"><i class="fa fa-clipboard"></i></span> Generate Test Plan</button>');' title="Generate the POAM in MS Excel" ','class="btn btn-success btn-sm"><span class="btn-label"><i class="fa fa-calendar"></i></span> Generate POAM</button>',$("#divSystemPOAM").html('<button style="margin: 2px; width: 100%; text-align: left;" type="button" id="btnGeneratePOAM" onclick="exportPOAM(getParameterByName(\'id\'), false);"  title="Generate the POAM in MS Excel" class="btn btn-success btn-sm"><span class="btn-label"><i class="fa fa-calendar"></i></span> Generate POAM</button>')}$("#divSystemCreated").html("<b>Created:</b> "+moment(s.created).format("MM/DD/YYYY hh:mm A")),s.updatedOn?$("#divSystemUpdated").html("<b>Last Updated:</b> "+moment(s.updatedOn).format("MM/DD/YYYY hh:mm A")):$("#divSystemUpdated").html("<b>Last Updated:</b> N/A"),s.lastComplianceCheck?$("#divSystemLastCompliance").html("<b>Last Compliance Check:</b> "+moment(s.lastComplianceCheck).format("MM/DD/YYYY hh:mm A")):$("#divSystemLastCompliance").html("<b>Last Compliance Check:</b> N/A")}}function resetAddSystemForm(){$("#frmNessusFile").trigger("filer.reset"),$("#frmSystemTitle").val(""),$("#frmSystemDescription").val("")}function resetEditSystemForm(){$("#frmNessusFile").trigger("filer.reset")}function addSystem(){if(!$("#frmSystemTitle").val()||!$("#frmSystemDescription").val())return alert("Please enter a system package title and description"),!1;swal("Adding System Package...",{buttons:!1,timer:3e3});var e=new FormData;return e.append("title",htmlEscape($("#frmSystemTitle").val())),e.append("description",htmlEscape($("#frmSystemDescription").val())),e.append("nessusFile",$("#frmNessusFile")[0].files[0]),$.ajax({url:saveAPI+"system/",data:e,type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},processData:!1,contentType:!1,success:function(e){swal("Your System Package was created successfully!","Click OK to continue!","success").then((t=>{location.href="checklists.html?id="+e.internalIdString}))},error:function(e){swal("There was a Problem. Your System Package was not created successfully. Please verify all required fields are filled in.","Click OK to continue!","error")}}),!1}function updateSystem(e){swal("Updating System...",{buttons:!1,timer:3e3}),e||(e=sessionStorage.getItem("currentSystem"));var t=new FormData;return t.append("title",htmlEscape($("#frmSystemTitle").val())),t.append("description",htmlEscape($("#frmSystemDescription").val())),t.append("nessusFile",$("#frmNessusFile")[0].files[0]),$.ajax({url:saveAPI+"system/"+e,data:t,type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},processData:!1,contentType:!1,success:function(e){swal("Your System was updated successfully!","Click OK to continue!","success").then((e=>{getSystemRecordBySession(),$("#customModal").modal("hide")}))},error:function(e){swal("There was a Problem. Your System was not updated successfully. Please check with the Application Admin.","Click OK to continue!","error")}}),!1}async function getScoreForSystemChecklistListing(e){scoreAPI;try{let t=await fetch(scoreAPI+"system/"+encodeURIComponent(e),{headers:{Authorization:"Bearer "+keycloak.token}});if(t.ok)return await t.json()}catch(e){return console.error("returning an empty score"),null}}function renderSystemPieChart(e,t){var a=document.getElementById(e).getContext("2d");new Chart(a,{type:"pie",data:{datasets:[{data:[t.totalCat1Open,t.totalCat2Open,t.totalCat3Open,t.totalNotAFinding,t.totalNotApplicable,t.totalNotReviewed],backgroundColor:["rgba(255, 99, 132, 1)","rgba(255, 153, 0, 1)","rgba(216, 216, 14, 1)","rgba(0, 204, 0, 1)","rgba(150, 150, 150, 1)","rgba(242, 242, 242, 1)"],label:"System Severity Breakdown"}],labels:["CAT 1 Open","CAT 2 Open","CAT 3 Open","Not a Finding","N/A","Not Reviewed"]},options:{responsive:!0,maintainAspectRatio:!1,aspectRatio:1,legend:{display:!0,position:"bottom",labels:{fontSize:10,padding:5}},plugins:{labels:{render:"value",fontSize:14,fontColor:"#000",fontFamily:'"Lucida Console", Monaco, monospace'}}}})}async function downloadNessusXML(e){e||(e=sessionStorage.getItem("currentSystem")),$.blockUI({message:"Generating the Nessus file...please wait",css:{padding:"15px"}});var t=readAPI+"system/"+encodeURIComponent(e)+"/downloadnessus/",a=new XMLHttpRequest;a.open("GET",t,!0),a.setRequestHeader("Authorization","Bearer "+keycloak.token),a.responseType="blob",a.onload=function(e){if(200===this.status){var t=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,fileName);else{var s=window.document.createElement("a"),n=a.getResponseHeader("Content-Type");s.href=window.URL.createObjectURL(new Blob([t],{type:n})),s.download=$.trim($("#frmSystemTitle").val().replace(" ","-"))+".nessus",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}},a.send(),$.unblockUI()}async function getNessusFileSummaryData(e){e||(e=sessionStorage.getItem("currentSystem"));readAPI;try{let t=await fetch(readAPI+"system/"+encodeURIComponent(e)+"/nessuspatchsummary/",{headers:{Authorization:"Bearer "+keycloak.token}});if(t.ok)return await t.json();if("Not Found"==t.statusText)return null}catch(e){return console.error("returning an empty summary of patches"),null}}async function exportNessusXML(e,t){e||(e=sessionStorage.getItem("currentSystem")),$.blockUI({message:"Generating the Nessus Excel export...please wait",css:{padding:"15px"}});var a=readAPI+"system/"+e+"/exportnessus?summaryOnly="+t.toString(),s=new XMLHttpRequest;s.open("GET",a,!0),s.setRequestHeader("Authorization","Bearer "+keycloak.token),s.responseType="blob",s.onload=function(e){if(200===this.status){var a=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,fileName);else{var n=window.document.createElement("a"),o=s.getResponseHeader("Content-Type");n.href=window.URL.createObjectURL(new Blob([a],{type:o})),n.download=t?$.trim($("#frmSystemTitle").val().replace(" ","-"))+"-NessusScanSummary.xlsx":$.trim($("#frmSystemTitle").val().replace(" ","-"))+"-NessusScanSummaryByHost.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else alert("There was a problem exporting your report."),$.unblockUI()},s.send(),$.unblockUI()}async function exportTestPlan(e){e||(e=sessionStorage.getItem("currentSystem")),$.blockUI({message:"Generating the System Test Plan Excel export...please wait",css:{padding:"15px"}});var t=readAPI+"system/"+e+"/testplanexport/",a=new XMLHttpRequest;a.open("GET",t,!0),a.setRequestHeader("Authorization","Bearer "+keycloak.token),a.responseType="blob",a.onload=function(e){if(200===this.status){var t=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,fileName);else{var s,n=window.document.createElement("a"),o=a.getResponseHeader("Content-Type"),i=new Date;s=i.getFullYear().toString()+"-"+(i.getMonth()+1).toString()+"-"+i.getDate().toString()+"-"+i.getHours().toString()+"-"+i.getMinutes().toString()+"-"+i.getSeconds().toString(),n.href=window.URL.createObjectURL(new Blob([t],{type:o})),n.download=$.trim($("#frmSystemTitle").val().replace(" ","-"))+"-TestPlanSummary-"+s+".xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else alert("There was a problem exporting your report."),$.unblockUI()},a.send(),$.unblockUI()}async function exportPOAM(e){e||(e=sessionStorage.getItem("currentSystem")),$.blockUI({message:"Generating the POA&amp;M Excel export...please wait",css:{padding:"15px"}});var t=readAPI+"system/"+e+"/poamexport/",a=new XMLHttpRequest;a.open("GET",t,!0),a.setRequestHeader("Authorization","Bearer "+keycloak.token),a.responseType="blob",a.onload=function(e){if(200===this.status){var t=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,fileName);else{var s,n=window.document.createElement("a"),o=a.getResponseHeader("Content-Type"),i=new Date;s=i.getFullYear().toString()+"-"+(i.getMonth()+1).toString()+"-"+i.getDate().toString()+"-"+i.getHours().toString()+"-"+i.getMinutes().toString()+"-"+i.getSeconds().toString(),n.href=window.URL.createObjectURL(new Blob([t],{type:o})),n.download=$.trim($("#frmSystemTitle").val().replace(" ","-"))+"-POAM-"+s+".xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else alert("There was a problem exporting your report."),$.unblockUI()},a.send(),$.unblockUI()}function runComplianceFromSystem(e){location.href=e?"compliance.html?id="+e:"compliance.html?id="+sessionStorage.getItem("currentSystem")}function uploadFromSystem(e){location.href=e?"upload.html?id="+e:"upload.html?id="+sessionStorage.getItem("currentSystem")}function uploadFromChecklist(){location.href="upload.html?id="+sessionStorage.getItem("currentSystem")}async function deleteSystem(e){e||(e=sessionStorage.getItem("currentSystem")),e&&e.length>10&&swal({title:"Delete an Entire System",text:"Are you sure you wish to delete this system and all its checklists and files?",icon:"warning",buttons:!0,dangerMode:!0}).then((t=>{t?$.ajax({url:saveAPI+"system/"+e,type:"DELETE",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your System Package was deleted successfully!","Click OK to continue!","success").then((e=>{location.href="systems.html"}))},error:function(e){swal("There was a Problem. Your System Package was not deleted successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the System Deletion.")}))}async function deleteSystemPatchScanFile(e){e||(e=sessionStorage.getItem("currentSystem")),e&&e.length>10&&swal({title:"Delete Your System Package Patch Scan File",text:"Are you sure you wish to delete this system package patch scan file?",icon:"warning",buttons:!0,dangerMode:!0}).then((t=>{t?$.ajax({url:saveAPI+"system/"+e+"/patchscan",type:"DELETE",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your System Package patch scan was deleted successfully!","Click OK to continue!","success").then((e=>{location.reload()}))},error:function(e){swal("There was a Problem. Your System Package patch scan file was not deleted successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the System Package patch file deletion.")}))}function getSystemScoreChartBySession(){var e=sessionStorage.getItem("currentSystem");e?getSystemScoreChart(e):location.href="systems.html"}async function getSystemScoreChart(e){e||(e=sessionStorage.getItem("currentSystem"));var t=await getScoreForSystemChecklistListing(e);t&&renderSystemPieChart("chartSystemScore",t)}async function deleteSystemChecklists(e){e||(e=sessionStorage.getItem("currentSystem"));var t=new FormData,a=$("#tblChecklistListing :checkbox:checked").map((function(){return this.value})).get();t.append("checklistIds",a),e&&e.length>10&&swal({title:"Delete Selected System Checklists",text:"Are you sure you wish to delete the selected System Checklists?",icon:"warning",buttons:!0,dangerMode:!0}).then((a=>{a?$.ajax({url:saveAPI+"system/"+e+"/artifacts",type:"DELETE",data:t,processData:!1,contentType:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your System Package Checklists were deleted successfully!","Note: for larger lists this may take a few moments. Click OK to continue!","success").then((e=>{location.reload()}))},error:function(e){swal("There was a Problem. Your System Package Checklists were not deleted successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the System Checklist Deletion.")}))}async function deleteAllSystemChecklists(e){e||(e=sessionStorage.getItem("currentSystem")),e&&e.length>10&&swal({title:"Delete All System Checklists",text:"Are you sure you wish to delete all the System Checklists?",icon:"warning",buttons:!0,dangerMode:!0}).then((t=>{t?$.ajax({url:saveAPI+"system/"+e+"/artifacts",type:"DELETE",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your System Package Checklists were deleted successfully!","Note: for larger lists this may take a few moments. Click OK to continue!","success").then((e=>{location.reload()}))},error:function(e){swal("There was a Problem. Your System Package Checklists were not deleted successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the System Checklist Deletion.")}))}async function downloadAllSystemChecklists(e){$("#txtSystemName").val()&&$("#txtSystemName").val(),$.blockUI({message:"Generating the System Checklist ZIP...please wait",css:{padding:"15px"}});var t=readAPI;getParameterByName("id")?t+="system/download/"+encodeURIComponent(getParameterByName("id")):t+="system/download/"+encodeURIComponent(sessionStorage.getItem("currentSystem")),t+="/?naf="+$("#chkVulnNaF").is(":checked"),t+="&open="+$("#chkVulnOpen").is(":checked"),t+="&na="+$("#chkVulnNA").is(":checked"),t+="&nr="+$("#chkVulnNR").is(":checked"),t+="&cat1="+$("#chkVulnCAT1").is(":checked"),t+="&cat2="+$("#chkVulnCAT2").is(":checked"),t+="&cat3="+$("#chkVulnCAT3").is(":checked");var a=new XMLHttpRequest;a.open("GET",t,!0),a.setRequestHeader("Authorization","Bearer "+keycloak.token),a.responseType="blob",a.onload=function(e){if(200===this.status){var t=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,fileName);else{var s=window.document.createElement("a"),n=a.getResponseHeader("Content-Type");s.href=window.URL.createObjectURL(new Blob([t],{type:n})),s.download=$.trim($("#txtSystemName").val())+"-checklists.zip",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}},a.send(),$.unblockUI()}async function getChecklistsBySystem(){var e=$("#checklistSystemFilter").val();await getChecklists(e)}function getChecklistListingBySession(){var e=sessionStorage.getItem("currentSystem");e?getChecklists(e):location.href="systems.html"}function getChecklistsByFilter(){setSystemChecklistFilter(),getParameterByName("rtn")?getChecklistListingBySession():getChecklists(getParameterByName("id"))}function getSystemChecklistFilter(){if(null!=sessionStorage.getItem("systemFilter")){var e=JSON.parse(sessionStorage.getItem("systemFilter"));$("#chkVulnNaF").prop("checked",e.naf),$("#chkVulnOpen").prop("checked",e.open),$("#chkVulnNA").prop("checked",e.na),$("#chkVulnNR").prop("checked",e.nr),$("#chkVulnCAT1").prop("checked",e.cat1),$("#chkVulnCAT2").prop("checked",e.cat2),$("#chkVulnCAT3").prop("checked",e.cat3),$("#chkVulnHostname").val(e.hostname)}}function setSystemChecklistFilter(){var e={naf:$("#chkVulnNaF").is(":checked"),open:$("#chkVulnOpen").is(":checked"),na:$("#chkVulnNA").is(":checked"),nr:$("#chkVulnNR").is(":checked"),cat1:$("#chkVulnCAT1").is(":checked"),cat2:$("#chkVulnCAT2").is(":checked"),cat3:$("#chkVulnCAT3").is(":checked"),hostname:$("#chkVulnHostname").val()};sessionStorage.setItem("systemFilter",JSON.stringify(e))}async function getChecklists(e){$.blockUI({message:"Updating the checklist listing...",css:{padding:"15px"}}),sessionStorage.setItem("currentSystem",e);var t=readAPI+"systems/"+encodeURIComponent(e);t+="/?naf="+$("#chkVulnNaF").is(":checked"),t+="&open="+$("#chkVulnOpen").is(":checked"),t+="&na="+$("#chkVulnNA").is(":checked"),t+="&nr="+$("#chkVulnNR").is(":checked"),t+="&cat1="+$("#chkVulnCAT1").is(":checked"),t+="&cat2="+$("#chkVulnCAT2").is(":checked"),t+="&cat3="+$("#chkVulnCAT3").is(":checked"),t+="&hostname="+$("#chkVulnHostname").val(),sessionStorage.removeItem("checklistSystems");let a=await fetch(t,{headers:{Authorization:"Bearer "+keycloak.token}});if(!a.ok)throw $.unblockUI(),new Error(a.status);var s=await a.json();$("#divSystemListing").hide(),$("#divChecklistListing").show(),$("#btnListAllSystems").show();var n=$("#tblChecklistListing").DataTable();n.clear().draw();var o="",i="";if(0==s.length){$.unblockUI();'<button type="button" class="close" data-dismiss="alert" aria-label="Close">','<span aria-hidden="true">&times;</span></button>',$("#divMessaging").html('There are no Checklists uploaded. Please Upload your first.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),$("#divMessaging").show()}else{$("#btnExportListToExcel").prop("disabled",!1),$("#divMessaging").html(""),$("#divMessaging").hide();for(const e of s){$("#txtListingTitle").text()||($("#txtListingTitle").text(e.systemTitle),$("#txtSystemName").val(e.systemTitle)),o='<a href="single-checklist.html?id='+e.internalIdString+'" title="View the Checklist Details">',o+=e.title,o+='</a><br /><span class="small">last updated on ',e.updatedOn?o+=moment(e.updatedOn).format("MM/DD/YYYY hh:mm A"):o+=moment(e.created).format("MM/DD/YYYY hh:mm A"),o+="</span>",i="",e.tags&&(i=e.tags.toString().replace(/\,/g,", "));var l=await getScoreForChecklistListing(e.internalIdString);l?n.row.add({title:o,id:e.internalIdString,tags:i,totalNaF:l.totalNotAFinding,totalNA:l.totalNotApplicable,totalOpen:l.totalOpen,totalNR:l.totalNotReviewed,totalNaFCat1:l.totalCat1NotAFinding,totalNACat1:l.totalCat1NotApplicable,totalOpenCat1:l.totalCat1Open,totalNRCat1:l.totalCat1NotReviewed,totalNaFCat2:l.totalCat2NotAFinding,totalNACat2:l.totalCat2NotApplicable,totalOpenCat2:l.totalCat2Open,totalNRCat2:l.totalCat2NotReviewed,totalNaFCat3:l.totalCat3NotAFinding,totalNACat3:l.totalCat3NotApplicable,totalOpenCat3:intOpenCat2=l.totalCat3Open,totalNRCat3:l.totalCat3NotReviewed}).draw():n.row.add({title:o,id:e.internalIdString,tags:i,totalNaF:0,totalNA:0,totalOpen:0,totalNR:0,totalNaFCat1:0,totalNACat1:0,totalOpenCat1:0,totalNRCat1:0,totalNaFCat2:0,totalNACat2:0,totalOpenCat2:0,totalNRCat2:0,totalNaFCat3:0,totalNACat3:0,totalOpenCat3:0,totalNRCat3:0}).draw()}$.unblockUI()}}async function getScoreForChecklistListing(e,t){scoreAPI;t&&templateAPI;try{let t=await fetch(scoreAPI+"artifact/"+e,{headers:{Authorization:"Bearer "+keycloak.token}});if(t.ok)return await t.json()}catch(e){return console.error("returning an empty score"),null}}async function getChecklistSystemsForChecklistFilter(){var e=await getChecklistSystems();e&&$.each(e,(function(e,t){$("#checklistSystemFilter").append($("<option/>",{value:t.internalIdString,text:t.title}))}))}function returnToChecklistListing(){location.href="checklists.html?rtn=1"}function returnToTemplateListing(){location.href="templates.html"}async function exportChecklistListingXLSX(){$("#txtSystemName").val()&&$("#txtSystemName").val(),$.blockUI({message:"Generating the System Checklist Excel export...please wait",css:{padding:"15px"}});var e=readAPI;getParameterByName("id")?e+="system/export/"+encodeURIComponent(getParameterByName("id")):e+="system/export/"+encodeURIComponent(sessionStorage.getItem("currentSystem")),e+="/?naf="+$("#chkVulnNaF").is(":checked"),e+="&open="+$("#chkVulnOpen").is(":checked"),e+="&na="+$("#chkVulnNA").is(":checked"),e+="&nr="+$("#chkVulnNR").is(":checked"),e+="&cat1="+$("#chkVulnCAT1").is(":checked"),e+="&cat2="+$("#chkVulnCAT2").is(":checked"),e+="&cat3="+$("#chkVulnCAT3").is(":checked");var t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Authorization","Bearer "+keycloak.token),t.responseType="blob",t.onload=function(e){if(200===this.status){var a=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,fileName);else{var s=window.document.createElement("a"),n=t.getResponseHeader("Content-Type");s.href=window.URL.createObjectURL(new Blob([a],{type:n})),s.download=$.trim($("#txtSystemName").val())+"-listing.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}},t.send(),$.unblockUI()}async function getChecklistData(e,t){var a=readAPI+"artifact";t&&(a=templateAPI);let s=await fetch(a+"/"+e,{headers:{Authorization:"Bearer "+keycloak.token}});if(s.ok){clearSessionData();var n=await s.json(),o=n.title;$("#checklistTitle").html('<i class="fa fa-table"></i> '+o);var i="Last Updated on ";if(n.updatedOn?i+=moment(n.updatedOn).format("MM/DD/YYYY hh:mm A"):i+=moment(n.created).format("MM/DD/YYYY hh:mm A"),$("#checklistSystem").html("<b>System:</b> "+n.systemTitle),$("#checklistHost").html("<b>Host:</b> "+n.checklist.asset.hosT_NAME),$("#checklistFQDN").html("<b>FQDN:</b> "+n.checklist.asset.hosT_FQDN),$("#checklistTechArea").html("<b>Tech Area:</b> "+n.checklist.asset.tecH_AREA),$("#checklistAssetType").html("<b>Asset Type:</b> "+n.checklist.asset.asseT_TYPE),$("#checklistRole").html("<b>Role:</b> "+n.checklist.asset.role),n.tags?$("#checklistTags").html("<b>Tags:</b> "+n.tags.toString().replace(/\,/g,", ")):$("#checklistTags").html("<b>Tags:</b> "),$("#divMessaging").html(""),t?$("#checklistSTIGTitle").html("<b>Title:</b> "+n.title+" ("+n.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[7].siD_DATA+")"):$("#checklistSTIGTitle").html("<b>Title:</b> "+n.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[7].siD_DATA),$("#checklistSTIGReleaseInfo").html("<b>Release:</b> "+n.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[6].siD_DATA.replace("Release: ","")),$("#checklistSTIGVersionInfo").html("<b>Version:</b> "+n.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[0].siD_DATA),t&&n.description&&$("#templateDescription").html("<b>Description:</b> "+n.description),$("#chartSeverityUpdated").text(i),$("#chartCategoryUpdated").html(i),$("#barChartUpdated").html(i),$("#checklistLastUpdated").html(i),t&&getScoreForTemplateListing(n.rawChecklist),await getChecklistSystemsForChecklist(),$("#frmChecklistSystem").val(n.systemGroupId),$("#frmChecklistTitle").text(n.title),$("#frmChecklistHost").val(n.checklist.asset.hosT_NAME),$("#frmChecklistFQDN").val(n.checklist.asset.hosT_FQDN),$("#frmChecklistTechArea").val(n.checklist.asset.tecH_AREA),$("#frmChecklistAssetType").val(n.checklist.asset.asseT_TYPE),$("#frmChecklistRole").val(n.checklist.asset.role),$("#frmChecklistTags").empty(),n.tags&&n.tags.length>0)for(const e of n.tags)$("#frmChecklistTags").append($("<option/>",{value:e,text:e})),$("#frmChecklistTags option[value='"+e+"']").attr("selected","selected");var l="",r="[",c=[],u=getParameterByName("ctrl");if(u&&(c=await getVulnerabilitiesByControl(e,u)),c&&0==c.length)$("#divVulnFilter").show(),$("#rowControlInformation").hide();else{$("#divVulnFilter").hide();var d=await getControlInformation(u);d&&($("#checklistControlTitle").html(d.family+": "+d.number+" - "+d.title),$("#checklistControlGuidance").html(d.supplementalGuidance),$("#rowControlInformation").show())}for(const e of n.checklist.stigs.iSTIG.vuln)sessionStorage.setItem(e.stiG_DATA[0].attributE_DATA,JSON.stringify(e)),(0==c.length||jQuery.inArray(e.stiG_DATA[0].attributE_DATA,c)>-1)&&(l+='<button id="btnVulnerability-'+e.stiG_DATA[0].attributE_DATA+'" type="button" class="btn btn-sm ',e.severitY_OVERRIDE?l+=getVulnerabilityStatusClassName(e.status,e.severitY_OVERRIDE):l+=getVulnerabilityStatusClassName(e.status,e.stiG_DATA[1].attributE_DATA),l+='" title="'+e.stiG_DATA[5].attributE_DATA+'" ',l+=" onclick=\"viewVulnDetails('"+e.stiG_DATA[0].attributE_DATA+"'); return false;\">",l+=e.stiG_DATA[0].attributE_DATA+"</button><br />"),r+='{"vulnId" : "'+e.stiG_DATA[0].attributE_DATA+'", "status" : "'+e.status+'"},';if(r=r.slice(0,-1)+"]",sessionStorage.setItem("vulnStatus",r),$("#checklistTree").html(l),sessionStorage.setItem("currentSystem",n.systemGroupId),t)$("#divMessaging").html(""),$("#divMessaging").hide();else{var h=await newChecklistAvailable(n.systemGroupId,n.internalIdString);if(null!=h){var m="ATTN: There is an updated checklist release for your checklist: V";m+=h.version+" "+h.stigRelease,canUpload()&&(m+=' &nbsp; &nbsp; <button type="button" id="btnUpgradeChecklist" title="Upgrade the checklist to the latest version and release" onclick="upgradeChecklist(getParameterByName(\'id\'), false);" ',m+=' class="btn btn-primary btn-sm"><span class="btn-label"><i class="fa fa-long-arrow-up"></i></span> Upgrade</button>'),$("#divMessaging").html(m),$("#divMessaging").show()}else $("#divMessaging").html(""),$("#divMessaging").hide()}}else $("#txtBadChecklistId").text(e),$("#divBadChecklistId").show()}function openChecklistMetadata(){$("#editChecklistMetadata").modal({show:!0,focus:!0,backdrop:"static"}),$("#frmChecklistTags").select2({tags:!0,allowClear:!0,selectOnClose:!0,placeholder:" Add 1 or more tags",tokenSeparators:[","," "],minimumInputLength:3})}async function newChecklistAvailable(e,t){var a=templateAPI+"checklistupdate/system/"+e+"/artifact/"+t;let s=await fetch(a,{headers:{Authorization:"Bearer "+keycloak.token}});return s.ok?await s.json():null}function setVulnerabilityFilter(e,t){$("#chkVulnNaF").prop("checked",!1),$("#chkVulnOpen").prop("checked",!1),$("#chkVulnNA").prop("checked",!1),$("#chkVulnNR").prop("checked",!1),$("#chkVulnCAT1").prop("checked",!1),$("#chkVulnCAT2").prop("checked",!1),$("#chkVulnCAT3").prop("checked",!1),"open"==e?$("#chkVulnOpen").prop("checked",!0):"naf"==e?$("#chkVulnNaF").prop("checked",!0):"nr"==e?$("#chkVulnNR").prop("checked",!0):"na"==e&&$("#chkVulnNA").prop("checked",!0),"cat1"!=t&&"all"!=t||$("#chkVulnCAT1").prop("checked",!0),"cat2"!=t&&"all"!=t||$("#chkVulnCAT2").prop("checked",!0),"cat3"!=t&&"all"!=t||$("#chkVulnCAT3").prop("checked",!0),updateVulnerabilityListingByFilter();var a=document.getElementById("divVulnerabilities");a&&a.scrollIntoView()}function updateVulnerabilityListingByFilter(){var e=JSON.parse(sessionStorage.getItem("vulnStatus"));if(e){clearVulnDetails();var t="",a="",s="";for(const n of e){if(showVulnId(n))s=(a=JSON.parse(sessionStorage.getItem(n.vulnId)))?a.severitY_OVERRIDE?a.severitY_OVERRIDE:a.stiG_DATA[1].attributE_DATA:"high",t+='<button id="btnVulnerability-'+n.vulnId+'" ',t+=' type="button" class="btn btn-sm ',t+=getVulnerabilityStatusClassName(n.status,s),t+='" title="'+n.vulnId+'" ',t+=" onclick=\"viewVulnDetails('"+n.vulnId+"'); return false;\">",t+=n.vulnId+"</button><br />"}$("#checklistTree").html(t),t="",a="",s=""}}function showVulnId(e){var t=$("#chkVulnOpen").prop("checked"),a=$("#chkVulnNaF").prop("checked"),s=$("#chkVulnNA").prop("checked"),n=$("#chkVulnNR").prop("checked"),o=$("#chkVulnCAT1").prop("checked"),i=$("#chkVulnCAT2").prop("checked"),l=$("#chkVulnCAT3").prop("checked"),r=e.status.toLowerCase(),c="high",u=JSON.parse(sessionStorage.getItem(e.vulnId));u&&(c=u.stiG_DATA[1].attributE_DATA.toLowerCase());var d=!1;return("not_reviewed"==r&&n||"open"==r&&t||"not_applicable"==r&&s||"notafinding"==r&&a)&&(d=!0),d&&(d=!("high"!=c||!o)||(!("medium"!=c||!i)||!("low"!=c||!l))),d}function getVulnerabilityStatusClassName(e,t){return"not_reviewed"==e.toLowerCase()||"not reviewed"==e.toLowerCase()?"vulnNotReviewed":"open"!=e.toLowerCase()?"not_applicable"==e.toLowerCase()||"not applicable"==e.toLowerCase()?"vulnNotApplicable":"vulnNotAFinding":"high"==t.toLowerCase()?"vulnOpenCAT1":"medium"==t.toLowerCase()?"vulnOpenCAT2":"low"==t.toLowerCase()?"vulnOpenCAT3":void 0}function getPatchVulnerabilityClassName(e){return e>=3?"vulnOpenCAT1":2==e?"vulnOpenCAT2":1==e?"vulnOpenCAT3":""}async function viewVulnDetails(e){var t=JSON.parse(sessionStorage.getItem(e));if(t){$("#divVulnerabilityForm").show(),$("#vulnId").html("<b>VULN ID:</b>&nbsp;"+e),$("#frmVulnID").val(e),$("#vulnStigId").html("<b>STIG ID:</b>&nbsp;"+t.stiG_DATA[4].attributE_DATA),$("#vulnRuleId").html("<b>Rule ID:</b>&nbsp;"+t.stiG_DATA[3].attributE_DATA),$("#vulnRuleName").html("<b>Rule Name:</b>&nbsp;"+t.stiG_DATA[2].attributE_DATA),$("#vulnRuleTitle").html("<b>Rule Title:</b>&nbsp;"+t.stiG_DATA[5].attributE_DATA),$("#frmVulnStatus").val(t.status),$("#vulnClassification").html("<b>Classification:</b>&nbsp;"+t.stiG_DATA[21].attributE_DATA.replace(/\n/g,"<br />")),$("#vulnSeverity").html("<b>Severity:</b>&nbsp;"+t.stiG_DATA[1].attributE_DATA.replace(/\n/g,"<br />")),$("#vulnDiscussion").html("<b>Discussion:</b>&nbsp;"+htmlEscape(t.stiG_DATA[6].attributE_DATA).replace(/\n/g,"<br />")),$("#vulnCheckText").html("<b>Check Content:</b>&nbsp;"+htmlEscape(t.stiG_DATA[8].attributE_DATA).replace(/\n/g,"<br />")),$("#vulnFixText").html("<b>Fix Text:</b>&nbsp;"+htmlEscape(t.stiG_DATA[9].attributE_DATA).replace(/\n/g,"<br />")),$("#frmVulnDetails").val(t.findinG_DETAILS),$("#frmVulnComments").val(t.comments),t.stiG_DATA[18].attributE_DATA&&$("#vulnSeverityOverrideGuidance").html("<b>Severity Override Guidance:</b>&nbsp;"+t.stiG_DATA[18].attributE_DATA.replace(/\n/g,"<br />")),t.severitY_OVERRIDE&&t.severitY_OVERRIDE.length>0?$("#frmVulnSecurityOverride").val(t.severitY_OVERRIDE):$("#frmVulnSecurityOverride").val(""),$("#frmVulnSecurityJustification").val(t.severitY_JUSTIFICATION);var a,s="";for(i=24;i<t.stiG_DATA.length;i++)if("CCI_REF"==t.stiG_DATA[i].vulN_ATTRIBUTE&&(s+="<b>"+t.stiG_DATA[i].attributE_DATA+"</b>: ",null!=(a=await getCCIItemRecord(t.stiG_DATA[i].attributE_DATA)))){s+=a.definition+"<br /><ul>";for(const e of a.references)s+="<li>"+e.title+" :: "+e.index+"</li>";s+="</ul>"}s=s.substring(0,s.length-2),$("#vulnCCIId").html(s),canUpload()?($("#btnSaveVulnerability").show(),$("#frmVulnIDTitle").text(e)):$("#btnSaveVulnerability").hide()}}async function getCCIItemRecord(e){complianceAPI;try{let t=await fetch(complianceAPI+"cci/"+e,{headers:{Authorization:"Bearer "+keycloak.token}});return t.ok?await t.json():null}catch(e){return console.error("returning an empty CCI Item"),null}}function clearVulnDetails(){$("#vulnId").html("Please select a Vulnerability ID to view its details."),$("#vulnStigId").html(""),$("#vulnRuleId").html(""),$("#vulnRuleName").html(""),$("#vulnRuleTitle").html(""),$("#vulnCCIId").html(""),$("#vulnClassification").html(""),$("#vulnSeverity").html(""),$("#vulnDiscussion").html(""),$("#vulnCheckText").html(""),$("#vulnFixText").html(""),$("#frmVulnDetails").val(""),$("#frmVulnComments").val(""),$("#frmVulnSecurityOverride").val(""),$("#frmVulnSecurityJustification").val(""),$("#frmBulkUpdateCheckbox").attr("checked",!1)}function updateSingleChecklist(e){var t=saveAPI+"artifact/"+e,a=new FormData;a.append("systemGroupId",$("#frmChecklistSystem").val()),a.append("hostname",htmlEscape($("#frmChecklistHost").val())),a.append("domainname",htmlEscape($("#frmChecklistFQDN").val())),a.append("techarea",$("#frmChecklistTechArea").val()),a.append("assettype",$("#frmChecklistAssetType").val()),a.append("machinerole",$("#frmChecklistRole").val());var s="";$("#frmChecklistTags option").each((function(){this.selected&&(s+=this.value+"|")})),a.append("tagList",htmlEscape(s)),$.ajax({url:t,data:a,type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},processData:!1,contentType:!1,success:function(e){$("#editChecklistMetadata").modal("hide"),swal("Your Checklist was updated successfully!","Click OK to continue!","success").then((e=>{getChecklistSystemsForChecklist(),location.reload(!0)}))},error:function(){swal("Your Checklist was not updated. Please check all values and try again.","Click OK to continue!","error")}})}function updateSingleChecklistVulnerability(e){var t=$("#frmVulnID").val();if(!t||t.length<4)return swal("Your Vulnerability was not updated. Please refresh the page and try again.","Click OK to continue!","success"),!1;var a=saveAPI+"artifact/"+e+"/vulnid/"+t,s=new FormData;s.append("systemGroupId",$("#frmChecklistSystem").val()),s.append("vulnid",t),s.append("status",$("#frmVulnStatus").val()),s.append("comments",htmlEscape($("#frmVulnComments").val())),s.append("details",htmlEscape($("#frmVulnDetails").val())),s.append("severityoverride",$("#frmVulnSecurityOverride").val()),s.append("justification",htmlEscape($("#frmVulnSecurityJustification").val())),s.append("bulkUpdate",$("#frmBulkUpdateCheckbox").prop("checked")),$.ajax({url:a,data:s,type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},processData:!1,contentType:!1,success:function(a){swal("Your Vulnerability was updated successfully!","Click OK to continue!","success").then((a=>{var s=JSON.parse(sessionStorage.getItem(t));s&&(s.severitY_OVERRIDE&&s.severitY_OVERRIDE.length>0?$("#btnVulnerability-"+t).removeClass(getVulnerabilityStatusClassName(s.status,s.severitY_OVERRIDE)):$("#btnVulnerability-"+t).removeClass(getVulnerabilityStatusClassName(s.status,s.stiG_DATA[1].attributE_DATA)),s.status=$("#frmVulnStatus").val(),s.findinG_DETAILS=$("#frmVulnDetails").val(),s.comments=$("#frmVulnComments").val(),s.severitY_OVERRIDE=$("#frmVulnSecurityOverride").val(),s.severitY_JUSTIFICATION=$("#frmVulnSecurityJustification").val(),sessionStorage.setItem(t,JSON.stringify(s))),s.severitY_OVERRIDE&&s.severitY_OVERRIDE.length>0?$("#btnVulnerability-"+t).addClass(getVulnerabilityStatusClassName(s.status,s.severitY_OVERRIDE)):$("#btnVulnerability-"+t).addClass(getVulnerabilityStatusClassName(s.status,s.stiG_DATA[1].attributE_DATA));var n=JSON.parse(sessionStorage.getItem("vulnStatus"));n.find((function(e){return e.vulnId==t})).status=s.status,sessionStorage.setItem("vulnStatus",JSON.stringify(n)),getChecklistScore(e),$("#vulnerabilityModal").modal("hide")}))},error:function(){swal("Your Vulnerability was not updated. Please check all values and try again.","Click OK to continue!","error")}})}async function getChecklistSystemsForChecklist(){var e=await getChecklistSystems();e&&$.each(e,(function(e,t){$("#frmChecklistSystem").append($("<option/>",{value:t.internalIdString,text:t.title}))}))}async function getChecklistScore(e){displayChecklistScores(await getScoreForChecklistListing(e))}async function displayChecklistScores(e){e?($("#checklistNotAFindingCount").html(e.totalNotAFinding.toString()),$("#checklistNotApplicableCount").html(e.totalNotApplicable.toString()),$("#checklistOpenCount").html(e.totalOpen.toString()),$("#checklistNotReviewedCount").html(e.totalNotReviewed.toString()),$("#cat1NotAFindingCount").html(e.totalCat1NotAFinding.toString()),$("#cat1NotApplicableCount").html(e.totalCat1NotApplicable.toString()),$("#cat1OpenCount").html(e.totalCat1Open.toString()),$("#cat1NotReviewedCount").html(e.totalCat1NotReviewed.toString()),$("#cat2NotAFindingCount").html(e.totalCat2NotAFinding.toString()),$("#cat2NotApplicableCount").html(e.totalCat2NotApplicable.toString()),$("#cat2OpenCount").html(e.totalCat2Open.toString()),$("#cat2NotReviewedCount").html(e.totalCat2NotReviewed.toString()),$("#cat3NotAFindingCount").html(e.totalCat3NotAFinding.toString()),$("#cat3NotApplicableCount").html(e.totalCat3NotApplicable.toString()),$("#cat3OpenCount").html(e.totalCat3Open.toString()),$("#cat3NotReviewedCount").html(e.totalCat3NotReviewed.toString()),makeChartSeverity(e),makeChartCategory(e),makeBarChartBreakdown(e)):($("#checklistNotAFindingCount").text("0"),$("#checklistNotApplicableCount").text("0"),$("#checklistOpenCount").text("0"),$("#checklistNotReviewedCount").text("0"))}async function makeChartSeverity(e){var t=document.getElementById("chartSeverity").getContext("2d");new Chart(t,{type:"pie",data:{datasets:[{data:[e.totalOpen,e.totalNotAFinding,e.totalNotApplicable,e.totalNotReviewed],backgroundColor:["rgba(255,99,132,1)","rgba(75, 192, 192, 1)","rgba(150, 150, 150, 1)","rgba(54, 162, 235, 1)"],label:"Checklist Severity Breakdown"}],labels:["Open","Not a Finding","Not Applicable","Not Reviewed"]},options:{responsive:!0,maintainAspectRatio:!1,aspectRatio:1,legend:{display:!0,position:"bottom",labels:{fontSize:10,padding:5}},plugins:{labels:{render:"value",fontSize:14,fontColor:"#000",fontFamily:'"Lucida Console", Monaco, monospace'}}}})}function downloadChart(e){var t=document.getElementById(e).toDataURL("image/jpg");(e=document.createElement("a")).setAttribute("href",t),e.setAttribute("download","OpenRMFChart.jpg"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function makeChartCategory(e){var t=document.getElementById("chartCategory").getContext("2d");new Chart(t,{type:"pie",data:{datasets:[{data:[e.totalCat1,e.totalCat2,e.totalCat3],backgroundColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)"],label:"Category Breakdown"}],labels:["CAT I","CAT II","CAT III"]},options:{responsive:!0,maintainAspectRatio:!1,aspectRatio:1,legend:{display:!0,position:"bottom",labels:{fontSize:10,padding:5}},plugins:{labels:{render:"value",fontSize:14,fontColor:"#000",fontFamily:'"Lucida Console", Monaco, monospace'}}}})}async function makeBarChartBreakdown(e){var t=document.getElementById("barChart").getContext("2d");new Chart(t,{type:"bar",data:{labels:["CAT I - Open","CAT I - Not a Finding","CAT I - N/A","CAT I - Not Reviewed","CAT II - Open","CAT II - Not a Finding","CAT II - N/A","CAT II - Not Reviewed","CAT III - Open","CAT III - Not a Finding","CAT III - N/A","CAT III - Not Reviewed"],datasets:[{label:"# Vulnerabilities by Status and Category",data:[e.totalCat1Open,e.totalCat1NotAFinding,e.totalCat1NotApplicable,e.totalCat1NotReviewed,e.totalCat2Open,e.totalCat2NotAFinding,e.totalCat2NotApplicable,e.totalCat2NotReviewed,e.totalCat3Open,e.totalCat3NotAFinding,e.totalCat3NotApplicable,e.totalCat3NotReviewed],backgroundColor:["rgba(255, 99, 132, 0.5)","rgba(75, 192, 192, 0.5)","rgba(150, 150, 150, 0.5)","rgba(54, 162, 235, 0.5)","rgba(255, 99, 132, 0.5)","rgba(75, 192, 192, 0.5)","rgba(150, 150, 150, 0.5)","rgba(54, 162, 235, 0.5)","rgba(255, 99, 132, 0.5)","rgba(75, 192, 192, 0.5)","rgba(150, 150, 150, 0.5)","rgba(54, 162, 235, 0.5)"],borderColor:["rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)","rgba(0,0,0,0.7)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}async function downloadChecklistFile(e,t){var a=readAPI;t&&(a=templateAPI);let s=await fetch(a+"download/"+e,{headers:{Authorization:"Bearer "+keycloak.token}});if(s.ok){var n=await s.text(),o=document.createElement("a"),i=$.trim($("#checklistTitle").text())+".ckl";o.setAttribute("href","data:application/xml;charset=utf-8,"+encodeURIComponent(n)),o.setAttribute("download",$.trim(i.replace(/\s+/g,"_").toLowerCase())),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}async function exportChecklistXLSX(e){var t=readAPI+"export/"+e+"/";if(getParameterByName("ctrl"))t+="?ctrl="+getParameterByName("ctrl");else{var a=$("#chkVulnOpen").prop("checked"),s=$("#chkVulnNaF").prop("checked"),n=$("#chkVulnNA").prop("checked"),o=$("#chkVulnNR").prop("checked");t+="?nf="+s.toString()+"&open="+a.toString()+"&na="+n.toString()+"&nr="+o.toString()}var i=new XMLHttpRequest;i.open("POST",t,!0),i.setRequestHeader("Authorization","Bearer "+keycloak.token),i.responseType="blob",i.onload=function(e){if(200===this.status){var t=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,fileName);else{var a=window.document.createElement("a"),s=i.getResponseHeader("Content-Type");a.href=window.URL.createObjectURL(new Blob([t],{type:s})),a.download=$.trim($("#checklistTitle").text())+".xlsx",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}},i.send()}async function deleteChecklist(e){e&&e.length>10&&swal({title:"Delete this Checklist?",text:"Are you sure you wish to delete this checklist?",icon:"warning",buttons:!0,dangerMode:!0}).then((t=>{t?$.ajax({url:saveAPI+"artifact/"+e,type:"DELETE",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your Checklist was deleted successfully!","Click OK to continue!","success").then((e=>{reloadSystemRecordBySession()}))},error:function(e){swal("There was a Problem. Your Checklist was not deleted successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the Deletion.")}))}function upgradeChecklist(e){var t=sessionStorage.getItem("currentSystem");null==t&&location.reload(),swal({title:"Upgrade this Checklist?",text:"Are you sure you wish to upgrade this checklist to the latest release?",icon:"warning",buttons:!0,dangerMode:!0}).then((a=>{a?$.ajax({url:saveAPI+"upgradechecklist/system/"+t+"/artifact/"+e,type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your Checklist was upgraded successfully!","Click OK to continue!","success").then((e=>{$("#divMessaging").html(""),$("#divMessaging").hide(),location.reload(!0)}))},error:function(e){swal("There was a Problem. Your checklist was not updated successfully. Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the Upgrade.")}))}async function getChecklistSystems(){let e=await fetch(readAPI+"systems",{headers:{Authorization:"Bearer "+keycloak.token}});if(e.ok){var t=await e.json();return sessionStorage.setItem("checklistSystems",JSON.stringify(t)),t}}async function getChecklistSystemsForUpload(e){sessionStorage.removeItem("checklistSystems"),$("#checklistSystem").children().remove().end();var t=await getChecklistSystems();t&&(t.length>0?$.each(t,(function(t,a){e&&a.internalIdString==e?optionString='<option selected value="'+a.internalIdString+'">'+a.title+"</option>":optionString='<option value="'+a.internalIdString+'">'+a.title+"</option>",$("#checklistSystem").append(optionString)})):($("#divNewChecklistSystem").hide(),$("#divNewChecklistSystemText").show()))}function uploadChecklist(){var e=new FormData;if(0==$("input[id=checklistFile]").length)return swal("Error on the Upload","You need to upload at least one checklist or DoD SCAP XCCDF file.","error"),!1;for(swal("Uploading Checklists...",{buttons:!1,timer:3e3}),i=0;i<$("input[id=checklistFile]").length;i++)if($("input[id=checklistFile]")[i].files.length>0)for(j=0;j<$("input[id=checklistFile]")[i].files.length;j++)e.append("checklistFiles",$("input[id=checklistFile]")[i].files[j]);if($("#checklistSystemText").is(":visible")){if(0==$("#checklistSystemText").val().trim().length)return swal("Error on the Upload","Please fill in the new System Name field.","error"),!1;e.append("system",$("#checklistSystemText").val().trim())}else e.append("systemGroupId",$("#checklistSystem").val());$.ajax({url:uploadAPI,data:e,type:"POST",processData:!1,contentType:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){if($("#checklistSystemText").is(":visible")&&(getChecklistSystemsForUpload(),$("#checklistSystem option:contains($('#checklistSystemText').val().trim())").attr("selected","selected"),$("#checklistSystemText").val(),$("#divNewChecklistSystemText").hide(),$("#divNewChecklistSystem").show()),0==e.failed)swal("Your "+e.successful+" Checklists were uploaded successfully!","Click OK to continue!","success");else{var t="There were "+e.failed+" failed checklists. Check that they have a valid Hostname and format. ( ";$.each(e.failedUploads,(function(e,a){e>0&&(t+="; "),t+=a})),t+=" ) Click OK to continue!",swal("You had "+e.successful+" Checklists uploaded successfully!",t,"error")}$("#checklistFile").trigger("filer.reset")},error:function(e){swal("Error Uploading Checklist","There was an error uploading some of your checklists. Please try again.","error")}})}function uploadTemplate(){swal("Uploading Template...",{buttons:!1,timer:3e3});var e=new FormData;e.append("type",$("#templateType").val()),e.append("title",htmlEscape($("#templateTitle").val())),e.append("description",htmlEscape($("#templateDescription").val())),e.append("checklistFile",$("#templateFile")[0].files[0]),$.ajax({url:templateAPI,data:e,type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},processData:!1,contentType:!1,success:function(e){swal("Your Template was uploaded successfully!",e.title+" is ready to use. Click OK to continue!","success"),$("#frmTemplateUpload")[0].reset(),$("#templateFile").trigger("filer.reset")},error:function(){swal("Error Uploading Template","There was an error uploading the template. Please try again.","error")}})}async function getChecklistTypeBreakdown(e){var t=readAPI+"counttype";e&&e.length>0&&"All"!=e&&(t+="?system="+encodeURIComponent(e));let a=await fetch(t,{headers:{Authorization:"Bearer "+keycloak.token}});if(a.ok){var s=await a.json(),n=document.getElementById("chartChecklistTypeBreakdown").getContext("2d"),o=new Chart(n,{type:"pie",data:{datasets:[{label:"Checklists by Type"}]},options:{responsive:!0}}),i=[],l=[],r=[];if(s.length>0)for(const e of s)i.push(e.count),l.push(e.stigType),r.push(getRandomColor());else i.push(0),l.push("None"),r.push(getRandomColor());o.data.datasets[0].data=i,o.data.labels=l,o.data.datasets[0].backgroundColor=r,o.update()}}async function getChecklistSystemsForReportFilter(){var e=await getChecklistSystems();e&&$.each(e,(function(e,t){$("#checklistSystemFilter").append($("<option/>",{value:t.internalIdString,text:t.title}))}))}async function getReportsBySystem(){await getChecklistTypeBreakdown($("#checklistSystemFilter").val())}async function getNessusPatchScanReport(){var e=$("#checklistSystemFilter").val();if(e&&0!=e.length){$.blockUI({message:"Generating the Nessus ACAS Patch Report...please wait",css:{padding:"15px"}});var t=$("#tblReportNessus").DataTable();t.clear().draw(),t.ajax.url(reportAPI+"system/"+e+"/acaspatchdata/").load(finalizeLoadingTable)}else swal("Please choose a system package for the report.","Click OK to continue!","error")}async function getSystemTotalsByTypeReport(){var e=$("#checklistSystemFilter").val();if(e&&0!=e.length){$.blockUI({message:"Generating the System Totals Chart...please wait",css:{padding:"15px"}});var t=await getScoreForSystemChecklistListing(e);t&&renderSystemReportPieChart("chartReportSystemTotalsBreakdown",t),$.unblockUI()}else swal("Please choose a system for the report.","Click OK to continue!","error")}function renderSystemReportPieChart(e,t){var a=document.getElementById(e).getContext("2d");new Chart(a,{type:"pie",data:{datasets:[{data:[t.totalCat1Open,t.totalCat2Open,t.totalCat3Open,t.totalNotAFinding,t.totalNotApplicable,t.totalNotReviewed],backgroundColor:["rgba(255, 99, 132, 1)","rgba(255, 153, 0, 1)","rgba(216, 216, 14, 1)","rgba(0, 204, 0, 1)","rgba(150, 150, 150, 1)","rgba(242, 242, 242, 1)"],label:"System Severity Breakdown"}],labels:["CAT 1 Open","CAT 2 Open","CAT 3 Open","Not a Finding","N/A","Not Reviewed"]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1,legend:{display:!0,position:"bottom",labels:{fontSize:10,padding:5}},plugins:{labels:{render:"value",fontSize:14,fontColor:"#000",fontFamily:'"Lucida Console", Monaco, monospace'}}}})}async function updateChecklistFilter(){var e=$("#checklistSystemFilter").val();if(!e||0==e.length)return void swal("Please choose a system for the report.","Click OK to continue!","error");$("#checklistFilter").empty();var t=readAPI+"systems/"+encodeURIComponent(e);let a=await fetch(t,{headers:{Authorization:"Bearer "+keycloak.token}});if(a.ok){var s=await a.json();s&&$.each(s,(function(e,t){$("#checklistFilter").append($("<option/>",{value:t.internalIdString,text:t.title}))}))}}async function getSystemChecklistReport(){var e=$("#checklistFilter").val();if(!e||0==e.length)return void swal("Please choose a checklist for the report.","Click OK to continue!","error");$.blockUI({message:"Generating the Checklist Report...please wait",css:{padding:"15px"}});var t=readAPI+"artifact";let a=await fetch(t+"/"+e,{headers:{Authorization:"Bearer "+keycloak.token}});if(a.ok){clearSessionData();var s=await a.json();s.updatedOn?moment(s.updatedOn).format("MM/DD/YYYY hh:mm A"):moment(s.created).format("MM/DD/YYYY hh:mm A");var n=$("#tblReportSystemChecklist").DataTable();n.clear().draw(),$("#checklistSystem").html("<b>System:</b> "+s.systemTitle),$("#checklistHost").html("<b>Host:</b> "+s.checklist.asset.hosT_NAME),$("#checklistFQDN").html("<b>FQDN:</b> "+s.checklist.asset.hosT_FQDN),$("#checklistTechArea").html("<b>Tech Area:</b> "+s.checklist.asset.tecH_AREA),$("#checklistAssetType").html("<b>Asset Type:</b> "+s.checklist.asset.asseT_TYPE),$("#checklistRole").html("<b>Role:</b> "+s.checklist.asset.role),s.tags?$("#checklistTags").html("<b>Tags:</b> "+s.tags.toString().replace(/\,/g,", ")):$("#checklistTags").html("<b>Tags:</b> "),$("#checklistSTIGTitle").html("<b>Title:</b> "+s.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[7].siD_DATA),$("#checklistSTIGReleaseInfo").html("<b>Release:</b> "+s.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[6].siD_DATA),$("#checklistSTIGVersionInfo").html("<b>Version:</b> "+s.checklist.stigs.iSTIG.stiG_INFO.sI_DATA[0].siD_DATA);var o="",l="",r="",c="",u="";for(const e of s.checklist.stigs.iSTIG.vuln){for(o=getStatusName(e.status),e.severitY_OVERRIDE?(c=r=e.severitY_OVERRIDE,u=e.severitY_JUSTIFICATION?e.severitY_JUSTIFICATION:""):(r=e.stiG_DATA[1].attributE_DATA,c="",u=""),l="",i=24;i<e.stiG_DATA.length;i++)"CCI_REF"==e.stiG_DATA[i].vulN_ATTRIBUTE&&(l+=e.stiG_DATA[i].attributE_DATA+", ");l=l.substring(0,l.length-2),n.row.add({vulnid:e.stiG_DATA[0].attributE_DATA,severity:r,ruleid:e.stiG_DATA[3].attributE_DATA,stigid:e.stiG_DATA[4].attributE_DATA,status:o,title:e.stiG_DATA[5].attributE_DATA,cci:l,discussion:e.stiG_DATA[6].attributE_DATA,checkContent:e.stiG_DATA[8].attributE_DATA,fixText:e.stiG_DATA[9].attributE_DATA,comments:e.comments,findingDetails:e.findinG_DETAILS,severityOverride:c,severityJustification:u}).draw()}$.unblockUI()}else $.unblockUI(),swal("There was a problem generating your report. Please contact your Application Administrator.","Click OK to continue!","error")}async function getControlsReport(){var e=$("#checklistPrivacyFilter")[0].checked;$.blockUI({message:"Generating the Controls Report...please wait",css:{padding:"15px"}});var t=$("#tblReportControls").DataTable();t.clear().draw(),t.ajax.url(controlAPI+"?pii="+e+"&impactlevel="+$("#checklistImpactFilter").val()).load(finalizeLoadingTable)}async function finalizeLoadingTable(){$.unblockUI()}async function getHostVulnerabilityReport(){var e=$("#checklistSystemFilter").val();if(!e||0==e.length)return void swal("Please choose a system for the report.","Click OK to continue!","error");var t=$("#vulnerabilityId").val();if(!t||t.length<5)return void swal("Please enter a Vulnerability Id for the report.","Click OK to continue!","error");$.blockUI({message:"Generating the Host Vulnerability Report...please wait",css:{padding:"15px"}});var a=reportAPI+"system/"+e+"/vulnid/"+t;let s=await fetch(a,{headers:{Authorization:"Bearer "+keycloak.token}});if(s.ok){clearSessionData();var n=await s.json(),o=$("#tblReportVulnerability").DataTable();o.clear().draw();var i="",l="",r="",c="",u="";for(const e of n){i=getStatusName(e.status),e.severityOverride?(c=r=e.severityOverride,u=e.severityJustification?e.severityJustification:""):(r=e.severity,c="",u=""),l="";for(const t of e.cciList)l+=t+", ";l.length>0&&(l=l.substring(0,l.length-2)),o.row.add({vulnid:e.vulnid,severity:r,hostname:e.hostname,ruleTitle:e.ruleTitle,status:i,cci:l,discussion:e.discussion,checkContent:e.checkContent,type:e.checklistType,release:e.checklistRelease,version:e.checklistVersion,fixText:e.fixText,comments:e.comments,details:e.details,severityOverride:c,severityJustification:u}).draw()}$.unblockUI()}else $.unblockUI(),swal("There was a problem generating your report. Please contact your Application Administrator.","Click OK to continue!","error")}async function getVulnerabilityStatusSeverityReport(){var e=$("#checklistSystemFilter").val();if(e&&0!=e.length){var t=$("#chkVulnCAT1").prop("checked"),a=$("#chkVulnCAT2").prop("checked"),s=$("#chkVulnCAT3").prop("checked");if(t||a||s){var n=$("#chkVulnOpen").prop("checked"),o=$("#chkVulnNaF").prop("checked"),i=$("#chkVulnNA").prop("checked"),l=$("#chkVulnNR").prop("checked");if(n||o||i||l){$.blockUI({message:"Generating the Vulnerability Status and Severity Report...please wait",css:{padding:"15px"}});var r=$("#tblReportVulnerabilityStatusSeverity").DataTable();r.clear().draw(),r.ajax.url(reportAPI+"system/"+e+"/?naf="+o+"&open="+n+"&na="+i+"&nr="+l+"&cat1="+t+"&cat2="+a+"&cat3="+s).load(finalizeLoadingTable)}else swal("Please choose at least one severity for the report.","Click OK to continue!","error")}else swal("Please choose at least one status for the report.","Click OK to continue!","error")}else swal("Please choose a system package for the report.","Click OK to continue!","error")}async function getVulnerabilityOverrideReport(){var e=$("#checklistSystemFilter").val();if(e&&0!=e.length){$.blockUI({message:"Generating the Vulnerability Override Report...please wait",css:{padding:"15px"}});var t=$("#tblReportVulnerabilityOverride").DataTable();t.clear().draw(),t.ajax.url(reportAPI+"system/"+e+"/override/").load(finalizeLoadingTable)}else swal("Please choose a system package for the report.","Click OK to continue!","error")}async function getControlsListing(){let e=await fetch(controlAPI+"majorcontrols/",{headers:{Authorization:"Bearer "+keycloak.token}});if(e.ok){var t=await e.json();$.each(t,(function(e,t){optionString='<option value="'+t.number+'">'+t.number+" - "+t.title+"</option>",$("#rmfControl").append(optionString)}))}}async function getChecklistActivity(){var e=$("#checklistSystemFilter").val();if(e&&0!=e.length){$.blockUI({message:"Generating the Checklist Activity Report...please wait",css:{padding:"15px"}});var t=$("#tblReportChecklistActivity").DataTable();t.clear().draw(),t.ajax.url(readAPI+"systems/"+encodeURIComponent(e)+"/").load(finalizeLoadingTable)}else swal("Please choose a system package for the report.","Click OK to continue!","error")}async function getRMFControlForHostReport(){var e=$("#checklistSystemFilter").val();if(!e||0==e.length)return void swal("Please choose a system for the report.","Click OK to continue!","error");var t=$("#rmfControl").val();if(!t||0==t.length)return void swal("Please choose an RMF Control for the report.","Click OK to continue!","error");$.blockUI({message:"Updating the Hosts for Control listing...this may take a minute",css:{padding:"15px"}});var a=complianceAPI+"system/"+encodeURIComponent(e)+"/?pii=true&filter=high&majorcontrol="+t;let s=await fetch(a,{headers:{Authorization:"Bearer "+keycloak.token}});if(s.ok){var n=await s.json();if(n.result.length>0){var o=$("#tblReportControlHost").DataTable();o.clear().draw();var i="",l="",r="";for(const e of n.result)if(i="",r="",e.complianceRecords.length>0)for(const t of e.complianceRecords)i="",l=getOverallCompliance(l,t.status),i+='<a href="/single-checklist.html?id=',i+=t.artifactId+"&ctrl="+e.control+'" title="View the Checklist Details" target="'+t.artifactId+'">',i+='<span class="'+getComplianceTextClassName(t.status)+'">'+t.title+"</span></a>",r='<span class="'+getComplianceTextClassName(t.status)+'">'+getStatusName(t.status),o.row.add([t.hostName,i,r]).draw()}else swal("Error Generating Hosts for Control","There are no checklists ready for this compliance report.","error")}else swal("Error Generating Hosts for Control","There was a problem generating the compliance for that system. Make sure the checklists are valid.","error");$.unblockUI()}async function reloadNessusPatchData(){swal({title:"Update all Nessus Data",text:"Are you sure you wish to update all Nessus ACAS Patch Data across all Systems?",icon:"warning",buttons:!0,dangerMode:!0}).then((e=>{e?$.ajax({url:reportAPI+"reloaddata/?datatype=nessusacas",type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your Refresh of Nessus Patch Data was initiated. Please give time for the old data to be removed and new data generated.","Click OK to continue!","success")},error:function(e){swal("There was a Problem. Your Nessus ACAS Patch data was not refreshed successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the Data Refresh.")}))}async function reloadVulnerabilityData(){swal({title:"Update all System Vulnerability Data",text:"Are you sure you wish to update all Vulnerability Data across all Systems?",icon:"warning",buttons:!0,dangerMode:!0}).then((e=>{e?$.ajax({url:reportAPI+"reloaddata/?datatype=vulnerability",type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+keycloak.token)},success:function(e){swal("Your Refresh of Vulnerability Data was initiated. Please give time for the old data to be removed and new data generated.","Click OK to continue!","success")},error:function(e){swal("There was a Problem. Your Vulnerability data was not refreshed successfully! Please check with the Application Admin.","Click OK to continue!","error")}}):swal("Canceled the Data Refresh.")}))}async function getChecklistUpgrades(){var e=$("#checklistSystemFilter").val();if(!e||0==e.length)return void swal("Please choose a system package for the report.","Click OK to continue!","error");$.blockUI({message:"Generating the Checklist Upgrade Report...please wait",css:{padding:"15px"}});var t=readAPI+"systems/"+encodeURIComponent(e)+"/";let a=await fetch(t,{headers:{Authorization:"Bearer "+keycloak.token}});if(a.ok){var s=await a.json(),n=$("#tblChecklistUpgrades").DataTable();n.clear().draw();var o={},i="";for(const t of s)null!=(o=await newChecklistAvailable(e,t.internalIdString))&&(i="V"+o.version+" "+o.stigRelease,n.row.add({internalIdString:t.internalIdString,title:t.title,stigType:t.stigType,version:t.version,stigRelease:t.stigRelease,hostName:t.hostName,updatedChecklist:i}).draw());$.unblockUI()}else $.unblockUI(),swal("There was a problem generating your report. Please contact your Application Administrator.","Click OK to continue!","error")}async function getAuditRecords(){$.blockUI({message:"Generating the Audit Listing...please wait",css:{padding:"15px"}});var e=$("#tblAuditRecords").DataTable();e.clear().draw(),e.ajax.url(auditAPI).load(finalizeLoadingTable)}async function getChecklistSystemsForComplianceFilter(e){var t=await getChecklistSystems();if(t){var a="";$.each(t,(function(t,s){a=e&&s.internalIdString==e?'<option selected value="'+s.internalIdString+'">'+s.title+"</option>":'<option value="'+s.internalIdString+'">'+s.title+"</option>",$("#checklistSystemFilter").append(a)}))}}async function getComplianceBySystem(){var e=$("#checklistSystemFilter").val();if(e&&e.length>0&&"All"!=e){$.blockUI({message:"Updating the compliance listing...this may take a minute",css:{padding:"15px"}});var t=$("#checklistPrivacyFilter")[0].checked,a=complianceAPI+"system/"+encodeURIComponent(e)+"/?pii="+t+"&filter="+$("#checklistImpactFilter").val();let d=await fetch(a,{headers:{Authorization:"Bearer "+keycloak.token}});if(d.ok){var s=await d.json();if(s.result.length>0){var n=$("#tblCompliance").DataTable();n.clear().draw();var o="",i=0,l="",r="",c="",u="";for(const e of s.result)if(i++,o="",u="",l!=e.control.substring(0,2)&&(l&&(c+="<div class='complianceSummaryListing'>",c+=getComplianceSummaryButton(l,r)+"</div>"),r="",l=e.control.substring(0,2)),e.complianceRecords.length>0)for(const t of e.complianceRecords)o="",i++,r=getOverallCompliance(r,t.status),o+='<a href="/single-checklist.html?id=',o+=t.artifactId+"&ctrl="+e.control+'" title="View the Checklist Details" target="'+t.artifactId+'">',o+='<span class="'+getComplianceTextClassName(t.status)+'">'+t.title+"</span></a>",u='<span class="'+getComplianceTextClassName(t.status)+'">'+getStatusName(t.status),n.row.add([i,e.control,e.title,o,u]).draw();else n.row.add([i,e.control,e.title,o,u]).draw();c?$("#divComplianceSummary").html(c):$("#divComplianceSummary").html("No Summary")}else swal("Error Generating Compliance","There are no checklists ready for this compliance report.","error")}else swal("Error Generating Compliance","There was a problem generating the compliance for that system. Make sure the checklists are valid.","error");$.unblockUI()}else swal("Choose a System","You must first choose a system to generate a Compliance Report.","info")}async function getComplianceBySystemExport(){var e=$("#checklistSystemFilter").val();if(e&&e.length>0){$.blockUI({message:"Generating the compliance export...this may take a minute",css:{padding:"15px"}});var t=$("#checklistPrivacyFilter")[0].checked,a=complianceAPI+"system/"+encodeURIComponent(e)+"/export/?pii="+t+"&filter="+$("#checklistImpactFilter").val(),s=new XMLHttpRequest;s.open("GET",a,!0),s.setRequestHeader("Authorization","Bearer "+keycloak.token),s.responseType="blob",s.onload=function(e){if(200===this.status){var t=this.response;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,fileName);else{var a,n=window.document.createElement("a"),o=s.getResponseHeader("Content-Type"),i=new Date;a=i.getFullYear().toString()+"-"+(i.getMonth()+1).toString()+"-"+i.getDate().toString()+"-"+i.getHours().toString()+"-"+i.getMinutes().toString()+"-"+i.getSeconds().toString(),n.href=window.URL.createObjectURL(new Blob([t],{type:o})),n.download=$.trim($("#checklistSystemFilter option:selected").text().replace(" ","-"))+"-Compliance-"+a+".xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}else alert("There was a problem exporting your report."),$.unblockUI()},s.send(),$.unblockUI()}}async function getVulnerabilitiesByControl(e,t){let a=await fetch(readAPI+""+e+"/control/"+encodeURIComponent(t),{headers:{Authorization:"Bearer "+keycloak.token}});if(a.ok)return await a.json();return[]}async function getControlInformation(e){let t=await fetch(controlAPI+""+encodeURIComponent(e),{headers:{Authorization:"Bearer "+keycloak.token}});if(t.ok)return await t.json();return[]}function getComplianceTextClassName(e){return"not_reviewed"==e.toLowerCase()?"vulnNotReviewedText":"open"==e.toLowerCase()?"vulnOpenCAT1Text":"not_applicable"==e.toLowerCase()?"vulnNotApplicableText":"vulnNotAFindingText"}function getStatusName(e){return"not_reviewed"==e.toLowerCase()?"Not Reviewed":"open"==e.toLowerCase()?"Open":"not_applicable"==e.toLowerCase()?"Not Applicable":"Not a Finding"}function getOverallCompliance(e,t){return e?"open"==t.toLowerCase()?t.toLowerCase():"open"!=e.toLowerCase()&&"not_reviewed"!=e.toLowerCase()?"not_reviewed"==t.toLowerCase()?t.toLowerCase():"notafinding":e.toLowerCase():t.toLowerCase()}function getComplianceSummaryButton(e,t){return"open"==t?"<button onclick='setComplianceDataTableFilter(\""+e+"\"); return false;' class='btn btn-danger' style='cursor: pointer;'><i class='fa fa-times'> "+e+"</i></button>":"notafinding"==t||"not_applicable"==t?"<button onclick='setComplianceDataTableFilter(\""+e+"\"); return false;' class='btn btn-success' style='cursor: pointer;'><i class='fa fa-check'>"+e+"</i></button>":"not_reviewed"==t?"<button onclick='setComplianceDataTableFilter(\""+e+"\"); return false;' class='btn btn-dark' style='cursor: pointer;'><i class='fa fa-eye-slash'> "+e+"</i></button>":"<button onclick='setComplianceDataTableFilter(\""+e+"\"); return false;' class='btn btn-outline-secondary' style='cursor: pointer;'><i class='fa fa-ban'> "+e+"</i></button>"}function setComplianceDataTableFilter(e){tableCompliance.search(e+"-").draw()}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function getRandomColor(){var e="rgba(";return e+=(Math.floor(256*Math.random())+0).toString(),e+=",",e+=(Math.floor(256*Math.random())+0).toString(),e+=",",e+=(Math.floor(256*Math.random())+0).toString(),e+=", 0.7)"}function htmlEscape(e){return e?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function decodeHtml(e){if(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}return""}function verifyUploadFromSystem(){canUpload()&&$("#btnUploadChecklist").show()}function isAdministrator(){return keycloak.hasRealmRole("Administrator")}function canDownload(){return keycloak.hasRealmRole("Download")||keycloak.hasRealmRole("Administrator")}function canUpload(){return keycloak.hasRealmRole("Editor")||keycloak.hasRealmRole("Administrator")}function canDelete(){return keycloak.hasRealmRole("Editor")||keycloak.hasRealmRole("Administrator")}function verifyDownloadSingleChecklist(){canDownload()&&($("#btnDownloadChecklist").show(),$("#btnExportChecklist").show(),$("#btnDownloadChartSeverity").show(),$("#btnDownloadChartCategory").show(),$("#btnDownloadBarChart").show())}function verifyAddSystem(){canUpload()&&$("#btnAddSystem").show()}function verifyDownloadTemplate(){canDownload()&&$("#btnDownloadTemplate").show()}function verifyDeleteTemplate(){canDelete()&&$("#btnDeleteTemplate").show()}function verifyDeleteChecklist(){canDelete()&&$("#btnDeleteChecklist").show()}function verifyDownloadCompliance(){canDownload()&&$("#btnComplianceExport").show()}function verifyUpdateChecklist(){canUpload()&&($("#btnUpdateChecklist").show(),$("#btnUploadChecklist").show())}function verifyUpdateSystem(){canUpload()&&($("#btnUpdateSystem").show(),$("#btnDeleteSystem").show(),$("#btnDeleteAllSystemChecklists").show(),$("#btnDeleteSystemChecklists").show())}function verifyDownloadSystemChart(){canDownload()&&$("#btnDownloadChartSystemScore").show()}function verifyReportRefreshData(){isAdministrator()&&($("#btnReloadNessusData").show(),$("#btnReloadVulnerabilityData").show())}function verifyCreateChecklist(){canUpload()&&$("#btnCreateChecklistFromTemplate").show()}function clearSessionData(){var e=sessionStorage.getItem("currentSystem"),t=sessionStorage.getItem("checklistSystems"),a=sessionStorage.getItem("systemFilter");sessionStorage.clear(),e&&"undefined"!=e&&sessionStorage.setItem("currentSystem",e),t&&"undefined"!=t&&sessionStorage.setItem("checklistSystems",t),a&&"undefined"!=a&&sessionStorage.setItem("systemFilter",a)}function setupProfileMenu(){"undefined"!=typeof keycloak&&$("#profileUserName").text(keycloak.tokenParsed.given_name)}$(document).on("click","#btnStayLoggedIn",(function(){bWarningAutoLogout=!1,resetLogoutTimer(),$("#modalAutoLogout").modal("hide")}));