<!-- 
	// Copyright (c) Cingulara LLC 2020 and Tutela LLC 2020. All rights reserved.
	// Licensed under the GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007 license. See LICENSE file in the project root for full license information.
-->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>OpenRMF Controls Report</title>
	<meta name="description" content="OpenRMF Controls Report">
	<meta name="author" content="Dale Bingham - https://www.cingulara.com">
	<meta name="referrer" content="origin">

	<!-- Favicon -->
	<link rel="shortcut icon" href="/assets/images/favicon.ico">
	<link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="/assets/favicons/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
	<link rel="manifest" href="/assets/favicons/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<!-- Bootstrap CSS -->
	<link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />

	<!-- Font Awesome CSS -->
	<link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

	<!-- Custom CSS -->
	<link href="/assets/css/style.css" rel="stylesheet" type="text/css" />
	<link href="/assets/plugins/sweetalert/sweetalert.css" rel="stylesheet" type="text/css" />

	<!-- BEGIN CSS for this page -->
	<link rel="stylesheet" type="text/css" href="/assets/css/dataTables.bootstrap4.min.css" />

	<style>
		td.details-control {
			background: url('/assets/plugins/datatables/img/details_open.png') no-repeat center center;
			cursor: pointer;
		}

		tr.shown td.details-control {
			background: url('/assets/plugins/datatables/img/details_close.png') no-repeat center center;
		}
	</style>
	<!-- END CSS for this page -->
</head>

<body class="adminbody">

	<script src="/assets/js/keycloak.min.js"></script>
	<script src="/js/auth.js"></script>

	<div id="main" style="display: none;">

		<!-- top bar navigation -->
		<div id="includeNavBarLink"></div>
		<!-- End Navigation -->

		<!-- Left Sidebar -->
		<div id="includeSidebarLink"></div>
		<!-- End Sidebar -->

		<div class="content-page">
			<!-- Start content -->
			<div class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-xl-12">
							<div class="breadcrumb-holder">
								<h1 class="main-title float-left">Reports - RMF Controls Report</h1>
								<ol class="breadcrumb float-right">
									<li class="breadcrumb-item">Home</li>
									<li class="breadcrumb-item active">Reports</li>
								</ol>
								<div class="clearfix"></div>
							</div>
						</div>
					</div>
					<!-- end row -->
					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 col-xl-4">
							<div class="card mb-3">
								<div class="card-header">
									<h3><i class="fa fa-filter"></i> Filters</h3>
								</div>
								<div class="card-body">
									<div>
										<form>
											<div class="form-group">
												<label class="checklistSystemsListLabel" id="checklistImpactFilterLabel"
													for="checklistImpactFilter">System Impact Level</label>
												<select class="form-control" id="checklistImpactFilter">
													<option value="">All</option>
													<option value="low">Low</option>
													<option value="moderate">Moderate</option>
													<option value="high">High</option>
												</select>
												<small id="titleSystem" class="form-text text-muted">Specify the Overall
													System Impact Level</small>
											</div>
											<div class="form-group">
												<label class="checklistSystemsListLabel"
													id="checklistPrivacyFilterLabel"
													for="checklistPrivacyFilter">Include PII / Privacy Data?</label>
												<input type="checkbox" class="form-control" id="checklistPrivacyFilter"
													style="width: 25px;">
												<small id="titleSystem" class="form-text text-muted">Check to include
													Privacy and PII Controls</small>
											</div>
											<div class="form-group">
												<button type="button" title="Run the RMF Controls report"
													class="btn btn-sm btn-primary" onclick="getControlsReport();">Run
													Report</button>
											</div>
										</form>
									</div>
								</div><!-- end card body -->
							</div><!-- end card-->
						</div>
					</div><!-- end row-->

					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
							<div class="card mb-3">
								<div class="card-header">
									<h3><i class="fa fa-table"></i> RMF Controls Listing</h3>
								</div>
								<div class="card-body">
									<div>
										<table id="tblReportControls" style="width: 100%;"
											class="table table-bordered table-hover display">
											<thead>
												<tr>
													<th></th>
													<th>Family</th>
													<th>Control</th>
													<th>Title</th>
													<th>Number</th>
													<th>Description</th>
												</tr>
											</thead>
											<tbody></tbody>
										</table>
									</div>
								</div><!-- end card body -->
							</div><!-- end card-->
						</div>
					</div><!-- end row-->

				</div>
				<!-- END container-fluid -->

			</div>
			<!-- END content -->

		</div>
		<!-- END content-page -->

		<footer class="footer">
			<div id="includeFooterLink"></div>
		</footer>
		<div id="includeAutoLogin"></div>

	</div>
	<!-- END main -->

	<script src="/assets/js/modernizr.min.js"></script>
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/moment.min.js"></script>

	<script src="/assets/js/popper.min.js"></script>
	<script src="/assets/js/bootstrap.min.js"></script>

	<script src="/assets/js/detect.js"></script>
	<script src="/assets/js/fastclick.js"></script>
	<script src="/assets/js/jquery.blockUI.js"></script>
	<script src="/assets/js/jquery.nicescroll.js"></script>

	<!-- App js -->
	<script src="/assets/js/pikeadmin.js"></script>
	<script src="/js/openrmf.js"></script>
	<script src="/js/apis.js"></script>
	<script src="/assets/js/jquery.dataTables.min.js"></script>
	<!-- <script src="/assets/js/dataTables.select.min.js"></script> -->
	<script src="/assets/js/dataTables.bootstrap4.min.js"></script>
	<script src="/assets/plugins/sweetalert/sweetalert.js"></script>

	<!-- BEGIN Java Script for this page -->

	<script>
		$(document).ready(function () {
			// authentication first
			keycloak.init({ onLoad: 'login-required' }).success(function (authenticated) {
				if (authenticated) {
					// setup the User Interface
					setupOpenRMFUI();

					// format the extra row data
					function format(d) {
						// `d` is the original data object for the row
						var impactLevel = "";
						if (d.lowimpact)
							impactLevel = "Low";
					    else if (d.moderateimpact)
							impactLevel = "Moderate";
						else if (d.highimpact)
							impactLevel = "High";
						else
							impactLevel = "N/A";
						return "<div><h6>Supplemental Guidance</h6>" + htmlEscape(d.supplementalGuidance).replace(/\n/g, "<br />") + "</div><br />" +
							"<div><h6>Impact Level</h6>" + impactLevel + "</div><br />" +
							"<div><h6>Priorty</h6>" + d.priority + "</div><br />";
					}

					// setup the table
					var tableControls = $('#tblReportControls').DataTable({
						"responsive": false,
						"searching": true,
						"pageLength": 25,
						"autoWidth": false,
						"deferRender": true,
						"ajax": {
							"dataSrc": ""
						},
						"columns": [
							{
								"className": 'details-control',
								"orderable": false,
								"data": null,
								"defaultContent": '',
								"targets": 0
							},
							{ "data": "family" },
							{ "data": "number" },
							{ "data": "title" },
							{ "data": "subControlNumber" },
							{ "data": "subControlDescription" }
						],
						"columnDefs": [
							{ "width": "5%", "targets": 0 },
							{ "width": "10%", "targets": 1 },
							{ "width": "5%", "targets": 2 },
							{ "width": "20%", "targets": 3 },
							{ "width": "10%", "targets": 4 },
							{ "width": "40%", "targets": 5 }
						] //,order: [[ 1, 'asc' ], [2,'asc']]
					});

					$.fn.dataTable.ext.errMode = function(obj,param,err){
						var tableId = obj.sTableId;
						//console.log('Handling DataTable issue of Table '+tableId);
					};

					// Add event listener for opening and closing details
					$('#tblReportControls tbody').on('click', 'td.details-control', function () {
						var tr = $(this).closest('tr');
						var row = tableControls.row(tr);

						if (row.child.isShown()) {
							// This row is already open - close it
							row.child.hide();
							tr.removeClass('shown');
						}
						else {
							// Open this row
							row.child(format(row.data())).show();
							tr.addClass('shown');
						}
					});
					$('#tblReportControls').DataTable().clear().draw();
				}
				else {
					alert('You are not logged in. Please check your setup with Keycloak.');
				}
			}).error(function () {
				alert('Keycloak did not respond correctly. Please verify your Keycloak realm as well as Redirect URI and Web Origins information. (i.e. are you missing an \'*\' somewhere?');
			});
		});
	</script>
	<!-- END Java Script for this page -->

</body>

</html>